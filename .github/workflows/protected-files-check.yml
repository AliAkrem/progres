name: Protected Files Check

concurrency:
  group: pre-ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

on:
  pull_request:
    paths:
      - '.github/workflows/**'
      - '**/ci.yml'

jobs:
  security-check:
    name: Security Check
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    steps:
      - uses: actions/checkout@v3
      
      - name: Validate Author Permissions
        env:
          GH_TOKEN: ${{ secrets.PAT_TOKEN }} 
        run: |
          echo "Checking permissions for user: ${{ github.event.pull_request.user.login }}"
          
          if ! gh api \
            /orgs/${{ github.repository_owner }}/teams/repo-maintainers/memberships/${{ github.event.pull_request.user.login }} \
            --silent; then
            echo "::error::Unable to verify team membership. User is not a maintainer."
            echo "::error::Please contact a maintainer for assistance"
            exit 1
          fi
          
          echo "Author is authorized to modify protected files"
